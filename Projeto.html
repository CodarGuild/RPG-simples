<!DOCTYPE html>

<html lang="pt-BR">  
<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
<title>RPG Turno Atualizado</title>  
<style>  
html, body { height:100%; margin:0; }  
body {  
  display:flex; justify-content:center; align-items:center;  
  background:#111; color:#eee; font-family:Arial, sans-serif;  
}  
#game-wrapper { width:100%; display:flex; justify-content:center; align-items:center; }  
#app { text-align:center; }  /* MAPAS */
.map { display:grid; gap:4px; background:#222; margin-top:10px; }
.village-map { grid-template-columns:repeat(4,48px); }
.world-map   { grid-template-columns:repeat(5,48px); }
.house-map   { grid-template-columns:repeat(3,48px); }
.forest-map  { grid-template-columns:repeat(5,48px); }

/* Tiles */
.tile {
width:48px; height:48px; background:#444;
display:flex; justify-content:center; align-items:center;
cursor:pointer; font-size:22px; color:white;
}
.player { background:#4CAF50!important; }
.npc    { background:#4299E1; }
.enemy  { background:#E53E3E; }
.house  { background:#A0522D; }
.forest { background:#2F855A; }
.tesure { background:#fff563; }
.movel  { background:#ffd0b0; }

/* BOTOÃÉES DE BATALHA */
.attack-btn, .battle-inv-btn {
background: linear-gradient(45deg, #ff4e50, #f9d423);
border:2px solid #f9d423;
padding:6px 12px; margin:4px;
font-size:16px; color:#111; font-weight:bold; border-radius:8px;
cursor:pointer;
}
.attack-btn:hover, .battle-inv-btn:hover { transform:scale(1.05); }

/* LOJA */
#shop-modal {
display:none; position:fixed; top:50%; left:50%;
transform:translate(-50%,-50%);
width:320px; padding:12px;
background:#222; border:2px solid #555; border-radius:8px;
z-index:200; text-align:center;
}
.shop-btn {
display:block; margin:6px auto; padding:6px 12px;
background:linear-gradient(45deg, #21520f, #58b337);; color:white;
border:solid #87ff5c; border-radius:5px;
cursor:pointer; font-size:14px;
}
.shop-btn:hover { background:#40916C; }

/* INVENTAÃÅRIO */
#inventory-modal {
display:none; position:fixed;
top:50%; left:50%; transform:translate(-50%,-50%);
width:300px; padding:12px;
background:#222; border:2px solid #555; border-radius:8px;
z-index:300;
}
#inventory-modal h3 {
margin:0; color:#f9d423; font-size:18px; text-align:center;
}
.inventory-stats { font-size:16px; margin:6px 0; text-align:left; padding-left:8px; }
.inventory-grid {
display:grid; grid-template-columns:repeat(4,50px);
gap:6px; justify-content:center;
}
.inventory-slot {
width:50px; height:50px;
background:#333; border:2px solid #555;
display:flex; justify-content:center; align-items:center;
font-size:22px; color:#f9d423;
cursor:pointer;
}
.inventory-slot.equipped { opacity:0.5; }
#close-inv {
margin-top:8px; padding:6px 10px;
background:#f9d423; color:#111; border:none; border-radius:5px;
font-weight:bold; cursor:pointer; font-size:14px;
}

/* DIAÃÅLOGO */
#dialog-box {
display:none; position:fixed;
top:50%; left:50%; transform:translate(-50%,-50%);
width:320px; padding:12px;
background:#222; border:2px solid #777; border-radius:8px;
z-index:400;
}
#dialog-box p { font-size:16px; margin:8px 0; }
#dialog-ok {
margin-top:8px; padding:6px 12px;
background:#f9d423; color:#111; border:none;
border-radius:5px; cursor:pointer; font-size:14px;
}
</style>

</head>  
<body>  
  <div id="game-wrapper"><div id="app"></div></div>  <!-- LOJA -->  <div id="shop-modal">  
  <h3>üõçÔ∏è Loja</h3>  
  <p id="gold-count"></p>  
  <button class="shop-btn" onclick="buyPotion()">Comprar Po√ß√£o de Cura (10 ü™ô)</button>  
  <button class="shop-btn" onclick="buyPotion1()">Comprar Ant√≠doto (15 ü™ô)</button>
  <button class="shop-btn" onclick="buySword()">Comprar Espada de Madeira (30 ü™ô)</button>  
  <button class="shop-btn" onclick="buyArmor()">Comprar Armadura de Couro (50 ü™ô)</button>  
  <button class="shop-btn" onclick="closeShop()">Fechar Loja</button>  
  <p id="shop-msg"></p>  
</div>  <!-- INVENT√ÅRIO -->  <div id="inventory-modal">  
  <h3>üì¶ Invent√°rio</h3>  
  <div class="inventory-stats" id="inv-stats"></div>  
  <div class="inventory-grid" id="inventory-grid"></div>  
  <button id="close-inv">Fechar Invent√°rio</button>  
</div>  <!-- DIAÃÅLOGO -->  <div id="dialog-box">  
  <p id="dialog-text"></p>  
  <button id="dialog-ok">OK</button>  
</div>  <script>  
let dialogActive = false;  
    
// ‚Äî Game Over ‚Äî  
function checkGameOver() {  
  if (player.hp <= 0) {  
    // Mostra tela de Game Over  
    document.getElementById("app").innerHTML = `  
      <div style="text-align:center; color:#f55; font-size:24px; padding:20px;">  
        <p>üíÄ GAME OVER üíÄ</p>  
        <button id="restart-btn" style="  
          padding:10px 18px;  
          font-size:18px;  
          background:#f9d423;  
          color:#111;  
          border:none;  
          border-radius:8px;  
          cursor:pointer;  
        ">Recome√ßar</button>  
      </div>  
    `;  
      
    document.getElementById("restart-btn").onclick = () => {  
      location.reload(); // recarrega a p√°gina para resetar tudo  
    };  
  
    return true;  
  }  
  return false;  
}  
  
// ‚Äî Encontros Aleatorios ‚Äî  
function tryRandomEncounter() {  
  if (area !== "world" && area !== "forest") return false;  
  
  if (Math.random() < 0.15 && area === "world") {  
    prevArea = area;  
    currentEnemy = {...enemies[Math.floor(Math.random() * 2)]};  
    area = "battle";  
    render();  
    return true;  
  }  
      
  else if (Math.random() < 0.25 && area === "forest") {  
    prevArea = area;  
    currentEnemy = {...enemies[Math.floor(Math.random() * (3 - 2 + 1) + 2)]};  
    area = "battle";  
    render();  
    return true;  
  }  
      
  return false;  
}  
    
// ‚Äî ESTADO DO JOGO ‚Äî  
let area="village";  
    
let prevArea = null;  
    
// ‚Äî Itens ‚Äî  
const ringItem = {  
  type: "üíç",  
  hpBonus: 10,      
  dmgBonus: 5
};  
    
const swordItem = {  
  type: "üó°Ô∏è",  
  hpBonus: 0,      
  dmgBonus: 5  
};  
    
const poutionItem = {  
  type: "üß™",  
  bonus: 25,       
};  
    
const poutionItem1 = {  
  type: "üíâ",  
  bonus: false,       
};  
  
const armorItem = {  
  type: "ü™ñ",  
  hpBonus: 10,      
  dmgBonus: 0  
};  
    
// ‚Äî Player ‚Äî  
const player={  
  x:3,y:0,  
  hp:50,maxHp:50, 
  dmg:5,
  inventory:[],   
  gold:0,  
  level:1,
  xp:0,
  metaDeXp:50,
  poisonTurns: 0,
  poisonDamage: 5,
  swordEquipped:false,  
  ringEquipped:false,  
  armorEquipped:false  
};  
    
// ‚Äî Mapas ‚Äî  
const houseVilaPos={x:1,y:3};  
const houseMap=[["üì¶","üõèÔ∏è",""],  
                ["","",""],  
                ["","‚¨áÔ∏è",""]];  
let housePlayer={x:1,y:2};  
  
const villageGrid=[  
  ["NPC","Vila","Vila","Sa√≠da"],  
  ["Vila","Vila","Vila","Vila"],  
  ["Vila","Vila","Vila","Vila"],  
  ["Loja","Casa","Vila","NPC"]  
];  
const worldGrid=[  
  ["Floresta","Campo","Campo","√Årvore","Campo"],  
  ["Campo","Campo","Campo","Campo","Campo"],  
  ["Sa√≠da","Campo","Casa","Campo","Campo"],  
  ["Campo","Campo","Campo","√Årvore","Campo"],  
  ["Campo","√Årvore","Campo","Campo","Campo"]  
];  
    
const forestGrid = [  
  ["√Årvore","√Årvore","√Årvore","√Årvore","√Årvore"],  
  ["√Årvore","Floresta","Floresta","Floresta","√Årvore"],  
  ["√Årvore","Floresta","√Årvore","Floresta","√Årvore"],  
  ["√Årvore","Floresta","√Årvore","Tesouro","√Årvore"],  
  ["√Årvore","Sa√≠da","√Årvore","√Årvore","√Årvore"]   
];  
  
// ‚Äî INIMIGOS ‚Äî  
const enemies=[  
  {name:"Slime",hp:15,maxHp:15,dmg:5,goldDrop:10,xp:10,canPoison:false},  
  {name:"Lobo",hp:20,maxHp:20,dmg:7,goldDrop:15,xp:15,canPoison:false},  
  {name:"Cogumelo",hp:45,maxHp:40,dmg:7,goldDrop:20,xp:20,canPoison:true},  
  {name:"Urso",hp:55,maxHp:55,dmg:12,goldDrop:25,xp:25,canPoison:false}  
];  
let currentEnemy=null,enemyPos={x:0,y:0};  
  
// ‚Äî DIAÃÅLOGO ‚Äî  
const dialogBox=document.getElementById("dialog-box");  
const dialogText=document.getElementById("dialog-text");  
const dialogOK=document.getElementById("dialog-ok");  
function showDialog(msg,callback){  
  dialogActive = true;  
  dialogText.textContent=msg;  
  dialogBox.style.display="block";  
  dialogOK.onclick=()=>{  
    dialogBox.style.display="none";  
    dialogActive = false;  
    if(callback) callback();  
  };  
}  
  
// ‚Äî LOJA ‚Äî  
const shopModal=document.getElementById("shop-modal");  
const goldCount=document.getElementById("gold-count");  
const shopMsg=document.getElementById("shop-msg");  
function openShop(){ goldCount.textContent=`ü™ô Ouro: ${player.gold}`; shopMsg.textContent=""; shopModal.style.display="block"; }  
function closeShop(){ shopModal.style.display="none"; }  
function buyPotion(){  
  if(player.gold>=10){ player.gold-=10; player.inventory.push({id: "po√ß√£o 01", type: poutionItem.type}); goldCount.textContent=`ü™ô Ouro: ${player.gold}`; shopMsg.textContent="Po√ß√£o comprada!"; }  
  else shopMsg.textContent="Ouro insuficiente!";  
}  
function buyPotion1(){  
  if(player.gold>=15){ player.gold-=15; player.inventory.push({id: "po√ß√£o 02", type: poutionItem1.type}); goldCount.textContent=`ü™ô Ouro: ${player.gold}`; shopMsg.textContent="Ant√≠doto comprada!"; }  
  else shopMsg.textContent="Ouro insuficiente!";  
}  
function buySword(){  
  if(player.gold>=30){ player.gold-=30; player.inventory.push({id: "espada 01", type: swordItem.type}); goldCount.textContent=`ü™ô Ouro: ${player.gold}`; shopMsg.textContent="Espada comprada!"; }  
  else shopMsg.textContent="Ouro insuficiente!";  
}  
function buyArmor(){  
  if(player.gold>=50){ player.gold-=50; player.inventory.push({id: "armadura 01", type: armorItem.type}); goldCount.textContent=`ü™ô Ouro: ${player.gold}`; shopMsg.textContent="Armadura comprada!"; }  
  else shopMsg.textContent="Ouro insuficiente!";  
}  
  
// ‚Äî INVENTAÃÅRIO ‚Äî  
const inventoryModal=document.getElementById("inventory-modal");  
const invGrid=document.getElementById("inventory-grid");  
const invStats=document.getElementById("inv-stats");  
document.getElementById("close-inv").onclick=()=> inventoryModal.style.display="none";  
  
function openInventory(){  
  invGrid.innerHTML="";  
  invStats.textContent=`‚ù§Ô∏è HP: ${player.hp}/${player.maxHp}   ‚öîÔ∏è AD: ${player.dmg}   ü™ô Ouro: ${player.gold}`;  
  
  player.inventory.forEach((item,i)=>{  
    const slot=document.createElement("div");  
    slot.classList.add("inventory-slot");  
    slot.textContent=item.type;  
    if(item.id==="espada 01" && player.swordEquipped) slot.classList.add("equipped");  
    if(item.id==="anel 01" && player.ringEquipped) slot.classList.add("equipped");  
    if(item.id==="armadura 01" && player.armorEquipped) slot.classList.add("equipped");  
      
    let pressTimer;  
  
    // quando come√ßa a pressionar  
    slot.addEventListener("mousedown", () => {  
      pressTimer = setTimeout(() => {  
        // DELETAR item ap√≥s segurar 800ms  
        player.inventory.splice(i, 1);  
        openInventory();  
      }, 800); // dura√ß√£o do ‚Äúsegurar‚Äù  
    });  
    
    slot.addEventListener("touchstart", () => {  
      pressTimer = setTimeout(() => {  
        player.inventory.splice(i, 1);  
        openInventory();  
      }, 800);  
    });  
    
    // quando solta antes do tempo  
    slot.addEventListener("mouseup", () => clearTimeout(pressTimer));  
    slot.addEventListener("mouseleave", () => clearTimeout(pressTimer));  
    slot.addEventListener("touchend", () => clearTimeout(pressTimer));  
    slot.addEventListener("touchcancel", () => clearTimeout(pressTimer));  
  
    slot.onclick=()=>{  
      if(item.id==="po√ß√£o 01"){  
        player.hp=Math.min(player.maxHp,player.hp + poutionItem.bonus);  
        player.inventory.splice(i,1);  
        openInventory();  
      }  
      
      else if(item.id==="po√ß√£o 02"){  
        player.poisoned=poutionItem1.bonus;  
        player.inventory.splice(i,1);  
        openInventory();  
      }  
        
      else if(item.id==="espada 01"){  
        player.swordEquipped=!player.swordEquipped;  
        if (player.swordEquipped) {  
          player.dmg+=swordItem.dmgBonus;    
        }  
          
        else {  
          player.dmg-=swordItem.dmgBonus;   
        }  
        openInventory();  
      }  
        
      else if(item.id==="anel 01"){  
        player.ringEquipped=!player.ringEquipped;  
        if (player.ringEquipped) {  
          player.maxHp+=ringItem.hpBonus;  
            
          player.dmg+=ringItem.dmgBonus;  
        }  
          
        else {  
          player.maxHp-=ringItem.hpBonus;  
            
          player.dmg-=ringItem.dmgBonus;  
        }  
        openInventory();  
      }  
        
      else if(item.id==="armadura 01"){  
        player.armorEquipped=!player.armorEquipped;  
        if (player.armorEquipped) {  
          player.maxHp+=armorItem.hpBonus;   
        }  
          
        else {  
          player.maxHp-=armorItem.hpBonus;    
        }  
        openInventory();  
      }  
    };  
  
    invGrid.appendChild(slot);  
  });  
  
  inventoryModal.style.display="block";  
}  
  
// ‚Äî MOVIMENTO ADJACENTE ‚Äî  
function isAdjacent(x,y,obj){  
  return Math.abs(obj.x-x)<=1 && Math.abs(obj.y-y)<=1 && !(obj.x===x && obj.y===y);  
}  
  
// ‚Äî RENDER ‚Äî  
function render(){  
  document.getElementById("app").innerHTML="";  
  shopModal.style.display="none";  
  inventoryModal.style.display="none";  
  dialogBox.style.display="none";  
  if(area==="village") renderVillage();  
  if(area==="world") renderWorld();  
  if(area==="battle") renderBattle();  
  if(area==="house") renderHouse();  
  if(area==="forest") renderForest();  
}  
    
// ‚Äî FLORESTA ‚Äî  
function renderForest(){  
  checkLevelUp();
  const cont=document.createElement("div"); cont.innerHTML="<h3>üå≤ Floresta</h3>";  
  const map=document.createElement("div"); map.classList.add("map","forest-map");  
  
  forestGrid.forEach((row,y)=>{  
    row.forEach((cell,x)=>{  
      const t=document.createElement("div"); t.classList.add("tile");  
      if(player.x===x && player.y===y) t.classList.add("player");  
      if(cell==="√Årvore"){ t.textContent="üå≤"; }  
      if(cell==="Tesouro"){ t.classList.add("tesure"); t.textContent="üí∞"; }  
      if(cell==="Sa√≠da"){ t.textContent="‚¨áÔ∏è"; }  
  
      t.onclick=()=>{  
        if(!isAdjacent(x,y,player)) return;  
        
        player.x=x; 
        player.y=y;  
        
        if(cell==="√Årvore"){  
          forestPlayer.x = x;  
          forestPlayer.y = y;  
          render();  
        }  
        else if(cell==="Tesouro"){   
          render();   
          player.inventory.push({id: "anel 01", type: ringItem.type});  
          forestGrid[3][3] = "Floresta";  
          showDialog("Voc√™ achou um anel!",()=>render());   
          return;  
        }  
        else if(cell==="Sa√≠da"){ player.x=0; player.y=0; area="world"; render(); }  
          
        else render();  
          
        if (tryRandomEncounter()) {  
          return;  
        }  
      };  
  
      map.appendChild(t);  
    });  
  });  
  
  cont.appendChild(map);   
  document.getElementById("app").appendChild(cont);  
}  
  
// ‚Äî VILA ‚Äî  
function renderVillage(){  
  const cont=document.createElement("div"); cont.innerHTML="<h3>üè° Vila</h3>";  
  const map=document.createElement("div"); map.classList.add("map","village-map");  
  
  villageGrid.forEach((row,y)=>{  
    row.forEach((cell,x)=>{  
      const t=document.createElement("div"); t.classList.add("tile");  
      if(player.x===x && player.y===y) t.classList.add("player");  
      if(cell==="NPC"){ t.classList.add("npc"); t.textContent="üôÇ"; }  
      if(cell==="Casa"){ t.classList.add("house"); t.textContent="üè†"; }  
      if(cell==="Sa√≠da"){ t.textContent="‚û°Ô∏è"; }  
      if(cell==="Loja"){ t.classList.add("npc"); t.textContent="üõçÔ∏è"; }  
  
      t.onclick=()=>{  
        if(!isAdjacent(x,y,player)) return; 
        
        player.x=x; 
        player.y=y;  

        if(cell==="NPC"){  
          const rnd = Math.random();  
          let textoNPC;  
          
          if (rnd < 0.5) {  
            textoNPC = "üôÇ NPC: Ol√°, como vai?";  
          } else {  
            textoNPC = "üôÇ NPC: Cuidado nas estradas‚Ä¶ ouvi rumores de monstros.";  
          }  
          
          render();   
          showDialog(textoNPC, ()=>render());  
        }  
        else if(cell==="Loja"){ render(); openShop(); }  
        else if(cell==="Sa√≠da"){ player.x=2; player.y=2; area="world"; render(); }  
        else if(cell==="Casa"){ area="house"; housePlayer.x=1; housePlayer.y=2; render(); }  
        else render();  
      };  
  
      map.appendChild(t);  
    });  
  });  
  
  cont.appendChild(map); document.getElementById("app").appendChild(cont);  
}  
  
// ‚Äî MUNDO ‚Äî  
function renderWorld(){  
  checkLevelUp();
  const cont=document.createElement("div"); cont.innerHTML="<h3>üåç Mundo</h3>";  
  const map=document.createElement("div"); map.classList.add("map","world-map");  
  worldGrid.forEach((row,y)=>{  
    row.forEach((cell,x)=>{  
      const t=document.createElement("div"); t.classList.add("tile");  
      if(player.x===x && player.y===y) t.classList.add("player");  
      if(cell==="√Årvore"){; t.textContent="üå≤"; }  
      if(cell==="Casa"){ t.classList.add("house"); t.textContent="üèòÔ∏è"; }  
      if(cell==="Floresta"){ t.classList.add("forest"); t.textContent="üå≤"; }
      if(cell==="Sa√≠da"){ t.textContent="‚¨ÖÔ∏è"; }      
  
      t.onclick = () => {  
        if(!isAdjacent(x,y,player)) return;  
        
        // mover o player  
        player.x = x;  
        player.y = y;  

        if(cell==="√Årvore"){  
          forestPlayer.x = x;  
          forestPlayer.y = y;  
          render();  
        } 
          
        if(cell==="Casa"){  
          player.x = 3;  
          player.y = 0;  
          area="village";  
          render();  
          return;  
        }  
        if(cell==="Floresta"){  
          player.x = 1;  
          player.y = 4;  
          area="forest";  
          render();  
          return;  
        }  
        
        // renderiza o mundo primeiro  
        render();  
        
        // tenta encontro aleat√≥rio com inimigo  
        if (tryRandomEncounter()) {  
          return;  
        }  
        
        // nada aconteceu, continua no mundo  
      };  
  
      map.appendChild(t);  
    });  
  });  
  
  cont.appendChild(map); document.getElementById("app").appendChild(cont);  
}  
  
// ‚Äî BATALHA ‚Äî  
function renderBattle(){  
  const cont=document.createElement("div"); cont.innerHTML=`<h3>‚öîÔ∏è Batalha: ${currentEnemy.name}</h3>`;  
  const info=document.createElement("div");  
  info.innerHTML=`<p>üë§ Voc√™: ${player.hp}/${player.maxHp} HP</p><p>üëæ ${currentEnemy.name}: ${currentEnemy.hp}/${currentEnemy.maxHp} HP</p>`;  
  cont.appendChild(info);  
  
  const log=document.createElement("p"); cont.appendChild(log);  
  
  // bot√£o para invent√°rio na batalha (sem duplicar a tela)  
  const invBtn = document.createElement("button");  
  invBtn.textContent = "üßæ Invent√°rio";  
  invBtn.classList.add("battle-inv-btn");  
    
  invBtn.onclick = () => {  
    if(dialogActive) return;  
    // guarda HP antes de abrir invent√°rio para aplicar dano depois  
    openInventory();  
    
    // substitui o bot√£o de fechar para aplicar dano ao fechar  
    document.getElementById("close-inv").onclick = () => {  
      // fecha apenas o invent√°rio  
      inventoryModal.style.display = "none";  
    
      // volta √† batalha normalmente (simples render, n√£o duplica)  
      render();  
    };  
  };  
    
  cont.appendChild(invBtn);  
  
  const btn=document.createElement("button");  
  btn.textContent="ü•ä ATACAR!";  
  btn.classList.add("attack-btn");  
  cont.appendChild(btn);  
    
  // Bot√£o de Fugir  
  const fleeBtn = document.createElement("button");  
  fleeBtn.textContent = "üèÉ‚Äç‚ôÇÔ∏è Fugir";  
  fleeBtn.classList.add("battle-inv-btn"); // usa o mesmo estilo de invent√°rio/batalha  
  cont.appendChild(fleeBtn);  
    
  fleeBtn.onclick = () => {  
    if(dialogActive) return;  
    const chance = Math.random();  
    if (chance < 0.25) {  
      showDialog("Voc√™ conseguiu fugir!", () => {  
        area = prevArea;  
        render();  
      });  
    } else {  
      // aplicar dano quando falhar  
      const edmg = Math.floor(Math.random()*currentEnemy.dmg) + 1;  
      player.hp -= edmg;  
      if (checkGameOver()) return;  
    
      if (player.poisoned) {
        player.hp -= player.poisonDamage;
        
        showDialog(`A fuga falhou! ${currentEnemy.name} causou ${edmg} e o veneno causa -${player.poisonDamage}!`, () => {  
          render(); // volta pra batalha normal  
        });  
        
        if (checkGameOver()) return; // checa se a vida acaba
      }
      
      else {
        showDialog(`A fuga falhou! ${currentEnemy.name} causou ${edmg}!`, () => {  
          render(); // volta pra batalha normal  
        });  
      }
      
    }  
  };  
  
  btn.onclick=()=>{  
    if(dialogActive) return;  
    const dmg=player.dmg;  
    const pdmg=Math.floor(Math.random()*dmg)+1;  
    currentEnemy.hp-=pdmg;  
      
    if(currentEnemy.hp<=0){  
      const goldEarned = currentEnemy.goldDrop;  
      player.gold += goldEarned;  
      const xp = currentEnemy.xp;
      player.xp += xp;
      render();  
      showDialog(`Voc√™ derrotou ${currentEnemy.name} e ganhou ${goldEarned} ü™ô e ${xp} XP!`, () => {  
        area = prevArea;  
        render();  
      }); 
      return;  
    }  
      
    const edmg=Math.floor(Math.random()*currentEnemy.dmg)+1;  
    player.hp-=edmg;  
    if (checkGameOver()) return; 
      
    if (currentEnemy.canPoison && Math.random() < 0.30 && player.poisoned !== true) {
      player.poisoned = true;
      log.textContent = `‚ö†Ô∏è Voc√™ foi envenenado por ${currentEnemy.name}!`;
      return;
    }
     
    if (player.poisoned) {
      player.hp -= player.poisonDamage;
      
      log.textContent = `Voc√™ causou ${pdmg}! ${currentEnemy.name} causou ${edmg}! Veneno causa -${player.poisonDamage} de dano!`;
      
      if (checkGameOver()) return; // checa se a vida acaba
    }
      
    else {
      log.textContent=`Voc√™ causou ${pdmg}! ${currentEnemy.name} causou ${edmg}!`;  
    }
    info.innerHTML=`<p>üë§ Voc√™: ${player.hp}/${player.maxHp} HP</p><p>üëæ ${currentEnemy.name}: ${currentEnemy.hp}/${currentEnemy.maxHp} HP</p>`;  
  };  
  
  document.getElementById("app").appendChild(cont);  
}  
  
// ‚Äî LEVEL UP ‚Äî
function checkLevelUp() {
  if (player.xp >= player.metaDeXp) {
    player.xp -= player.metaDeXp;
    player.level++;
    player.maxHp += 10;     
    player.dmg += 2;        
    player.hp = player.maxHp; 
    player.poisoned = false;
    player.metaDeXp += player.metaDeXp * 0.50;
    showDialog(`‚ú® Voc√™ subiu para o N√≠vel ${player.level}!`, () => render());
  }
}

// ‚Äî CASA ‚Äî
function renderHouse(){
  const cont=document.createElement("div"); cont.innerHTML="<h3>üè† Casa</h3>";
  const map=document.createElement("div"); map.classList.add("map","house-map");

  houseMap.forEach((row,y)=>{
    row.forEach((cell,x)=>{
      const t=document.createElement("div"); t.classList.add("tile");

      if(housePlayer.x===x && housePlayer.y===y) t.classList.add("player");
      if(cell==="üì¶") t.textContent="üì¶";
      if(cell==="üõèÔ∏è") t.textContent="üõèÔ∏è";
      if(cell==="‚¨áÔ∏è") t.textContent="‚¨áÔ∏è";

      t.onclick=()=>{
        if(!isAdjacent(x,y,housePlayer)) return;
        
        housePlayer.x=x; 
        housePlayer.y=y;

        if(cell==="üõèÔ∏è"){
          player.hp = player.maxHp;
          player.poisoned = false;
          render();
          showDialog("Voc√™ descansou e recuperou toda a vida!",()=>render());
        }
        else if(cell==="üì¶"){
          render();
          openInventory();
        }
        else if(cell==="‚¨áÔ∏è"){
          player.x=houseVilaPos.x; player.y=houseVilaPos.y;
          area="village"; render();
        }
        else render();
      };

      map.appendChild(t);
    });
  });

  cont.appendChild(map); document.getElementById("app").appendChild(cont);
}

render();
</script>

</body>
</html>